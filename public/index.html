<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <script>
        window.onload = function () {
            console.log('start')
            const SHEET_ID = '1dWUL3W7p5Wff_cvXQwd-hD3-kP4A2Y4glcK72XoIkfo'; // Google Sheet ID
            const API_KEY = 'AIzaSyCXmMCqNqYHkE7ttfsktdAUdKAgWnNVo6E'; // Google Sheets API key

            // Extract the short code from the URL
            //let shortCode = window.location.hash.substring(1);
            const hashShortCode = window.location.hash.substring(1);
            console.log(hashShortCode)
            const urlParams = new URLSearchParams(window.location.search);
            const queryShortCode = urlParams.get('go');
            console.log("Short Code from Query Parameter:", queryShortCode);
            console.log(window.location.search)


            // Define the function to fetch the data from Google Sheets
            async function fetchLinkFromSheet() {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/url!A:B?key=${API_KEY}`;
                console.log(url)
                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    // Loop through the sheet data to find a matching short code
                    let found = false;
                    data.values.forEach(row => {
                        if (row[0] === hashShortCode) {
                            window.location.href = row[1]; // Redirect to the original URL
                            console.log('row1', row[1])
                            found = true;
                        }
                    });

                    if (!found) {
                        document.body.innerHTML = "<p>Shortened link not found.</p>";
                    }

                } catch (error) {
                    console.error("Error fetching link: ", error);
                    document.body.innerHTML = "<p>Error occurred while fetching the link.</p>";
                }
            }

            // Call the function to perform the redirection
            fetchLinkFromSheet();
        }
    </script>
</head>

<body>
    <h1>Redirecting...</h1>
</body>

</html>

<!-- const hashShortCode = window.location.hash.substring(1);
console.log("Short Code from Hash:", hashShortCode);

// Extract short code from query parameter
const urlParams = new URLSearchParams(window.location.search);
const queryShortCode = urlParams.get('go');
console.log("Short Code from Query Parameter:", queryShortCode); -->